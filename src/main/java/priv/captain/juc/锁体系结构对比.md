
## 1️⃣ Java 锁体系结构概览

```
Lock（接口）
│
├─ ReentrantLock（可重入独占锁）
│   ├─ 支持公平锁/非公平锁
│   ├─ 可重入（同一个线程可重复获得）
│   ├─ 支持 Condition（等待/通知替代Object.wait/notify）
│   └─ 适用场景：高并发、需要响应中断、可超时等待、需要Condition的场景
│
└─ ReentrantReadWriteLock（读写锁）
    ├─ ReadLock（共享锁）
    ├─ WriteLock（独占锁）
    ├─ 可重入（读锁和写锁均可重入）
    ├─ 支持公平/非公平策略
    └─ 适用场景：读多写少的缓存、共享数据结构

StampedLock（独占/共享/乐观锁）
├─ 写锁（独占）
├─ 读锁（共享，不可重入）
├─ 乐观读锁（Optimistic Read，非阻塞，返回stamp）
├─ 不可重入（线程获得锁后再次尝试获取会死锁）
└─ 适用场景：性能敏感的读多写少场景，高并发读优化

synchronized（JVM内置锁）
├─ 独占锁（可重入）
├─ 可修饰方法/代码块
├─ 隐式释放锁（出作用域自动释放）
├─ 支持公平性取决于JVM实现
└─ 适用场景：简单同步、兼容性好，性能中等
```

---

## 2️⃣ 读写锁对比图（逻辑表格版）

| 锁类型                    | 读锁      | 写锁  | 可重入  | 公平性         | 性能        | 等待策略              | 适用场景             |
| ---------------------- | ------- | --- | ---- | ----------- | --------- | ----------------- | ---------------- |
| ReentrantReadWriteLock | 共享锁     | 独占锁 | 可重入  | 可选公平/非公平    | 高         | 支持条件等待（Condition） | 读多写少，缓存、共享数据结构   |
| StampedLock            | 乐观读/共享读 | 独占写 | 不可重入 | 无公平保证       | 极高（尤其乐观读） | 无阻塞等待（乐观锁）        | 高性能读多写少，性能敏感场景   |
| ReentrantLock          | -       | 独占锁 | 可重入  | 可选公平/非公平    | 高         | 支持Condition       | 高并发场景，需要可中断或可超时锁 |
| synchronized           | -       | 独占锁 | 可重入  | JVM内实现公平性有限 | 中         | 内置wait/notify     | 简单同步，兼容性好        |

---

## 3️⃣ 锁性能和适用场景总结

* **synchronized**：JVM内置锁，简单易用，适合小范围同步，升级后性能不错（JDK6+偏向锁/轻量级锁/自旋）。
* **ReentrantLock**：功能丰富，可响应中断/超时，适合复杂并发控制。
* **ReentrantReadWriteLock**：适合读多写少场景，读锁共享，写锁独占，可提高读性能。
* **StampedLock**：性能极致优化，提供乐观读，但不可重入，适合对性能极度敏感的读多写少场景。

---

## 4️⃣ 可视化锁关系图建议

```
Java锁体系
├─ 内置锁
│   └─ synchronized（可重入独占）
└─ Lock接口
    ├─ ReentrantLock（独占，可重入）
    ├─ ReentrantReadWriteLock
    │   ├─ ReadLock（共享，可重入）
    │   └─ WriteLock（独占，可重入）
    └─ StampedLock
        ├─ OptimisticRead（乐观读，不可重入）
        ├─ ReadLock（共享，不可重入）
        └─ WriteLock（独占，不可重入）
```

* 可用颜色标注：

  * 🔹 **独占锁**
  * 🔸 **共享锁**
  * 🟢 **可重入**
  * 🔴 **不可重入**

* 可以在读写锁下画一个“读锁共享、写锁独占”的对比图：

  ```
  多线程并发访问
  ┌───────────────┐
  │    ReadLock    │ <- 允许多个线程同时进入
  └───────────────┘
          ▲
          │
  ┌───────────────┐
  │   WriteLock    │ <- 独占，阻塞所有其他线程
  └───────────────┘
  ```

---
