## 1️⃣ Java SPI (Service Provider Interface)

**原理**：

* Java 原生机制，基于 `META-INF/services/接口全限定名` 文件注册实现类。
* `ServiceLoader.load(接口.class)` 动态加载实现类。

**特点**：

* **标准化**：Java 提供的原生接口。
* **解耦**：模块间只依赖接口，不依赖实现。
* **静态加载**：启动时扫描 `META-INF/services`。
* **有限的扩展能力**：不能直接控制加载顺序（Java 9+ 可结合 `@Priority`）。

**使用示例**：

```java
// 文件：META-INF/services/com.example.MyService
com.example.impl.MyServiceImpl1
com.example.impl.MyServiceImpl2

// 加载
ServiceLoader<MyService> loader = ServiceLoader.load(MyService.class);
for (MyService service : loader) {
    service.execute();
}
```

**优点**：标准、简单，JDK 自带
**缺点**：顺序控制弱、灵活性差

---

## 2️⃣ Spring SPI (SpringFactoriesLoader)

**原理**：

* Spring Boot 用 `META-INF/spring.factories` 文件注册实现类或配置类。
* `SpringFactoriesLoader.loadFactories(接口.class, classLoader)` 进行加载。

**特点**：

* **灵活**：支持 `@Order` 控制加载顺序。
* **懒加载/条件加载**：可结合 `@ConditionalOnClass`、`@ConditionalOnMissingBean` 等注解。
* **常用于自动配置**：Spring Boot 的 Starter、自动装配都是基于这个机制。

**使用示例**：

```properties
# META-INF/spring.factories
com.example.MyService=com.example.impl.MyServiceImpl1,com.example.impl.MyServiceImpl2
```

```java
List<MyService> services = SpringFactoriesLoader.loadFactories(MyService.class, getClass().getClassLoader());
services.forEach(MyService::execute);
```

**优点**：顺序可控、可条件化、适合自动配置
**缺点**：依赖 Spring 框架

---

## 3️⃣ Dubbo SPI

**原理**：

* Dubbo 提供扩展接口机制，基于 `META-INF/dubbo/接口全限定名` 文件注册实现类。
* 支持 `@Activate` 控制自动激活、排序、条件过滤。
* 有扩展点（ExtensionLoader）机制。

**特点**：

* **支持自动激活**：通过 `@Activate` 指定 group、value 等条件。
* **延迟加载**：按需加载扩展实现。
* **可插拔**：可按条件选择默认实现或自定义实现。

**使用示例**：

```properties
# META-INF/dubbo/com.example.MyService
impl1=com.example.impl.MyServiceImpl1
impl2=com.example.impl.MyServiceImpl2
```

```java
MyService service = ExtensionLoader.getExtensionLoader(MyService.class).getExtension("impl1");
service.execute();
```

**优点**：条件激活强、支持多实现管理、延迟加载
**缺点**：只能用于 Dubbo 体系，依赖 Dubbo

---

## 4️⃣ 三者对比总结

| 特性      | Java SPI           | Spring SPI (SpringFactoriesLoader)  | Dubbo SPI          |
| ------- | ------------------ | ----------------------------------- | ------------------ |
| 配置文件路径  | META-INF/services  | META-INF/spring.factories           | META-INF/dubbo/接口名 |
| 注解/顺序控制 | Java 9+: @Priority | @Order                              | @Activate          |
| 条件化/懒加载 | 不支持                | 支持 @Conditional                     | 支持 group/value 条件  |
| 加载方式    | ServiceLoader      | SpringFactoriesLoader.loadFactories | ExtensionLoader    |
| 应用场景    | JDK 标准插件机制         | Spring Boot 自动配置、扩展                 | Dubbo 框架扩展         |
| 灵活性     | 低                  | 高                                   | 高                  |

---

💡 **核心理解**：

1. **Java SPI** → 标准、简单、轻量，但顺序和条件能力弱。
2. **Spring SPI** → 自动配置利器，可控制加载顺序，条件化能力强。
3. **Dubbo SPI** → 高度扩展化，可条件激活，多实现管理方便。

---